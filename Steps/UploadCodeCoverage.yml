## @file
# Azure Pipelines step template upload code coverage to codecov.io
#
# Copyright (c) Microsoft Corporation. All rights reserved.
# SPDX-License-Identifier: BSD-2-Clause-Patent
##

parameters:
- name: codecov_token
  displayName: Codecov.io Token
  type: string
  default: ''
- name: report_dir
  displayName: Code Coverage Report
  type: string
  default: ''

steps:
- powershell: |
    $ProgressPreference = 'SilentlyContinue'
    Invoke-WebRequest -Uri https://uploader.codecov.io/latest/windows/codecov.exe -Outfile codecov.exe
    .\codecov.exe -t ${{ parameters.codecov_token }} -s ${{ parameters.report_dir }} -Z
  displayName: Upload Code Coverage to Codecov.io (Windows)
  condition: eq(variables['Agent.OS'], 'Windows_NT')

- script: |
    curl -Os https://uploader.codecov.io/latest/linux/codecov
    chmod +x codecov
    ./codecov -t ${{ parameters.codecov_token }} -s ${{ parameters.report_dir }} -Z
  displayName: Upload Code Coverage to Codecov.io (Linux)
  condition: eq(variables['Agent.OS'], 'Linux')
